---
title: "German Credit Example"
author: "Simon Dovan Nguyen"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
    toc_float: yes
    toc_collapsed: yes
    theme: lumen
    css: assets/styles.css
---

# Set Up

## Notes

## Libr.

```{r message=FALSE, warning=FALSE}
library(MASS)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(class)
library(glmnet)
library(caret)
library(nnet)
library(RcppAlgos)  #TVA
library(data.table) #TVA
```

## Rm. Var.

```{r}
rm(list=ls())
```

## Functions

```{r}
directory = "/Users/simondn/Documents/RashomonActiveLearning/"

if(exists("directory")){
  source(paste0(directory,"Code/functions/Auxiliary/LoadFunctions.R"))
  }else if(!exists("directory")){source("Code/functions/Main/LoadFunctions.R")}

```

# Generate Data

## Data
```{r}
data(GermanCredit)
dat = GermanCredit %>% 
  mutate(ID = 1:nrow(GermanCredit),
         Class = case_when(Class == "Good" ~ 0,
                           Class == "Bad" ~ 1)) %>%
  mutate(Class = as.factor(Class)) %>%
  rename(Y = Class) %>%
  select(ID,
         Y,
         Duration,
         Amount,
         InstallmentRatePercentage,
         ResidenceDuration,
         Age,
         NumberExistingCredits,
         NumberPeopleMaintenance,
         Telephone,
         ForeignWorker) %>%
  mutate(Telephone = Telephone + 1,
         ForeignWorker = ForeignWorker+1)
```


## Discretize
```{r}
NBins = 3
dat = dat %>% mutate(Duration = ntile(Duration, NBins),
                                       Amount = ntile(Amount, NBins),
                                       Age = ntile(Age, NBins))
```


# Inputs
```{r}
### Input ###
LabelName = "Y"
SelectorN = 1
seed = 1
TestProportion = 0.2
SelectorN = 1
InitialN = 10
NBins = 3

CovariateList = c("Duration",
                  "Amount",
                  "InstallmentRatePercentage",
                  "ResidenceDuration",
                  "Age",
                  "NumberExistingCredits",
                  "NumberPeopleMaintenance",
                  "Telephone",
                  "ForeignWorker")
RashomonParameters = list(K = K, 
                          NBins = NBins,
                          H = Inf,                           # Maximum number of pools/splits
                          R = NBins+1,                       # Bins of each arm (assume 0 exists)
                          reg = 0.1,                         # Penalty on the splits
                          theta = 3,                         # Threshold; determine relative to best model
                          inactive = 0)
```

## Algorithm
```{r}
SimulationFunc(dat = dat,
               LabelName = LabelName,
               CovariateList = CovariateList,
               TestProportion = TestProportion,
               SelectorType = "Random",
               SelectorN = SelectorN,
               ModelType = "Factorial",
               InitialN = InitialN,
               RashomonParameters = RashomonParameters,
               seed = seed) -> SimResultsBreakingTiesRandom
```

```{r}
SimulationFunc(dat = dat,
               LabelName = LabelName,
               CovariateList = CovariateList,
               TestProportion = TestProportion,
               SelectorType = "BreakingTies",
               SelectorN = SelectorN,
               ModelType = "Factorial",
               InitialN = InitialN,
               RashomonParameters = RashomonParameters,
               seed = seed) -> SimResultsBreakingTiesFactorial
```

```{r}
SimulationFunc(dat = dat,
               LabelName = LabelName,
               CovariateList = CovariateList,
               TestProportion = TestProportion,
               SelectorType = "BreakingTies",
               SelectorN = SelectorN,
               ModelType = "RashomonLinear",
               InitialN = InitialN,
               RashomonParameters = RashomonParameters,
               seed = seed) -> SimResultsBreakingTiesRashomon

```

## Visualize



```{r}
# ClassErrorPlotBreakingTies
# ClassErrorPlotRandom
# RandomPlot
# BreakingTiesPlot
SelectorTypeComparisonPlot
```

